name: Django CI/CD with Local Deploy

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.12'
    - run: pip install -r requirements.txt
    - run: python manage.py test

  notify-deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - name: Notify to run deploy.bat
      run: |
        echo "âœ… Tests passed!"
        echo "ðŸ“‹ Run deploy.bat manually from your local machine:"
        echo "   ./deploy.bat"
        echo ""
        echo "ðŸ”§ Or execute these commands manually:"
        echo "   git pull origin main"
        echo "   scp -r -i ~/.ssh/id_ed25519 ./* kelemnik@192.168.0.107:/home/kelemnik/app/"
        echo "   ssh -i ~/.ssh/id_ed25519 kelemnik@192.168.0.107 'cd /home/kelemnik/app && python3 -m pip install -r requirements.txt && python3 manage.py migrate'"